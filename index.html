<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Music Project - Ad-Free</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ffa36c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            color: #a0a0c0;
            font-size: 1rem;
        }

        .search-container {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1rem;
            outline: none;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa36c);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .player-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .ad-blocker-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 1000;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ffa36c);
        }

        .btn-sm {
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        .playlist {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .playlist h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #e0e0ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .clear-btn {
            background: rgba(255, 107, 107, 0.3);
            border: none;
            color: #ff6b6b;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: rgba(255, 107, 107, 0.5);
        }

        .playlist-item {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .playlist-item.active {
            background: rgba(255, 107, 107, 0.3);
            border-left: 4px solid #ff6b6b;
        }

        .playlist-item .play-icon {
            color: #ff6b6b;
        }

        .playlist-item .duration {
            margin-left: auto;
            color: #a0a0c0;
            font-size: 0.9rem;
        }

        .playlist-item .thumbnail {
            width: 60px;
            height: 45px;
            border-radius: 5px;
            object-fit: cover;
        }

        .playlist-item.blocked {
            opacity: 0.6;
            background: rgba(255, 0, 0, 0.1);
        }

        footer {
            margin-top: 30px;
            text-align: center;
            color: #a0a0c0;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #a0a0c0;
        }

        .error {
            text-align: center;
            padding: 20px;
            color: #ff6b6b;
        }

        .now-playing {
            background: rgba(255, 107, 107, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .now-playing img {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .now-playing-info {
            flex: 1;
        }

        .now-playing-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .now-playing-channel {
            color: #a0a0c0;
            font-size: 0.9rem;
        }

        .error-message {
            background: rgba(255, 107, 107, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #ffa36c);
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #a0a0c0;
        }

        .ad-skip-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            z-index: 100;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .search-container {
                flex-direction: column;
            }

            .now-playing {
                flex-direction: column;
                text-align: center;
            }
        }

        .playlist::-webkit-scrollbar {
            width: 8px;
        }

        .playlist::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .playlist::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.5);
            border-radius: 10px;
        }

        .playlist::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 107, 0.7);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>College Music Project</h1>
            <p class="subtitle">Ad-Free Music Experience</p>
        </header>

        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search for music...">
            <button class="search-btn" id="searchBtn">
                <i class="fas fa-search"></i> Search
            </button>
        </div>

        <div class="player-container">
            <div class="video-container">
                <div id="player"></div>
                <div class="ad-blocker-overlay">
                    <i class="fas fa-shield-alt"></i> Ad Blocker Active
                </div>
                <div class="ad-skip-indicator" id="adSkipIndicator">
                    <i class="fas fa-forward"></i> Skipping Ad...
                </div>
            </div>

            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="errorText">This video is not available for playback</span>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
            </div>

            <div class="controls">
                <button class="btn btn-sm" id="prevBtn">
                    <i class="fas fa-step-backward"></i> Prev
                </button>
                <button class="btn btn-sm" id="skipBackwardBtn">
                    <i class="fas fa-backward"></i> -10s
                </button>
                <button class="btn btn-primary" id="playPauseBtn">
                    <i class="fas fa-play"></i> Play
                </button>
                <button class="btn btn-sm" id="skipForwardBtn">
                    <i class="fas fa-forward"></i> +10s
                </button>
                <button class="btn btn-sm" id="nextBtn">
                    <i class="fas fa-step-forward"></i> Next
                </button>
            </div>

            <div id="nowPlaying" class="now-playing" style="display: none;">
                <img id="nowPlayingThumb" src="" alt="Now Playing">
                <div class="now-playing-info">
                    <div class="now-playing-title" id="nowPlayingTitle">Song Title</div>
                    <div class="now-playing-channel" id="nowPlayingChannel">Artist Name</div>
                </div>
            </div>

            <div class="playlist">
                <h2>
                    Search Results
                    <button class="clear-btn" id="clearPlaylist">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </h2>
                <div id="playlistItems">
                    <div class="loading">Search for music to populate the playlist</div>
                </div>
            </div>
        </div>

        <footer>
            <p>College Project - Educational Use Only</p>
        </footer>
    </div>

    <script>
        // Enhanced YouTube API integration with aggressive ad-blocking
        const API_KEY = 'AIzaSyAMGAR62RNI3Wu9YlKv43aq2-trVi1ZAM0';
        let player;
        let currentVideoIndex = 0;
        let searchResults = [];
        let blockedVideos = [];
        let isPlaying = false;
        let progressInterval;
        let adSkipInterval;
        let adDetectionInterval;

        // Aggressive ad-free content search terms
        const adFreeSearchTerms = [
            "no copyright music",
            "royalty free music", 
            "creative commons music",
            "non monetized music",
            "copyright free music",
            "background music no ads",
            "instrumental music royalty free",
            "lofi study music no copyright",
            "chillhop creative commons",
            "non copyrighted background music"
        ];

        // Known ad-free channels
        const adFreeChannels = [
            'chillhop',
            'lofi girl',
            'background music world',
            'no copyright sounds',
            'royalty free music',
            'creative commons',
            'non copyrighted music',
            'audio library'
        ];

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: '',
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'modestbranding': 1,
                    'rel': 0,
                    'fs': 0,
                    'iv_load_policy': 3,
                    'autohide': 1,
                    'autoplay': 1,
                    'disablekb': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        function onPlayerReady(event) {
            console.log("Ad-blocked player ready");
            document.getElementById('progressContainer').addEventListener('click', seekToPosition);
            
            // Start aggressive ad detection
            startAggressiveAdDetection();
            
            // Inject ad-blocking scripts
            injectAdBlockingScripts();
        }

        function onPlayerStateChange(event) {
            // Enhanced ad detection on state changes
            detectAndSkipAds();
            
            if (event.data === YT.PlayerState.ENDED) {
                playNextVideo();
            }

            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i> Pause';
                startProgressTracking();
                
                // Hide any ad indicators
                document.getElementById('adSkipIndicator').style.display = 'none';
            } else {
                isPlaying = false;
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i> Play';
                stopProgressTracking();
            }

            if (event.data === YT.PlayerState.PLAYING) {
                document.getElementById('errorMessage').style.display = 'none';
            }
        }

        function onPlayerError(event) {
            console.error('Player error:', event.data);
            document.getElementById('errorText').textContent = getErrorMessage(event.data);
            document.getElementById('errorMessage').style.display = 'block';

            if (searchResults[currentVideoIndex]) {
                blockedVideos.push(searchResults[currentVideoIndex].id);
                updatePlaylistUI();
            }

            setTimeout(playNextVideo, 1000);
        }

        function getErrorMessage(errorCode) {
            switch (errorCode) {
                case 2: return "Invalid parameter values.";
                case 5: return "Content cannot be played in HTML5 player.";
                case 100: return "Video not found.";
                case 101:
                case 150: return "Video owner doesn't allow embedding.";
                default: return "Unknown error occurred.";
            }
        }

        // Aggressive Ad Blocking Functions
        function startAggressiveAdDetection() {
            adDetectionInterval = setInterval(() => {
                detectAndSkipAds();
                blockYouTubeAds();
            }, 500);
        }

        function detectAndSkipAds() {
            if (!player) return;
            
            try {
                // Method 1: Check for sudden time jumps (ad insertion)
                const currentTime = player.getCurrentTime();
                const duration = player.getDuration();
                
                // Method 2: Check if video is unusually short (likely an ad)
                if (duration > 0 && duration < 60) {
                    console.log("Short video detected, likely an ad - skipping");
                    playNextVideo();
                    return;
                }
                
                // Method 3: Check player state for ad indicators
                if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                    // Additional checks can be added here
                }
                
            } catch (e) {
                // Silent fail for ad detection
            }
        }

        function blockYouTubeAds() {
            // Block YouTube's ad domains
            const adDomains = [
                'doubleclick.net',
                'googleads.g.doubleclick.net',
                'googlesyndication.com',
                'googleadservices.com',
                'ads.youtube.com',
                'youtube.com/api/stats/ads'
            ];
            
            // This would normally be done with a service worker or extension
            // For in-page blocking, we'll use a simpler approach
            try {
                const iframe = document.getElementById('player');
                if (iframe && iframe.contentWindow) {
                    // Attempt to block ad requests in the iframe
                    blockAdsInIframe(iframe);
                }
            } catch (e) {
                // Cross-origin restrictions prevent direct access
            }
        }

        function blockAdsInIframe(iframe) {
            // This is a simplified approach - in reality, this requires more complex techniques
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                // Remove any ad elements we can find
                const adSelectors = [
                    '.ad-container',
                    '.ad-display',
                    '.video-ads',
                    '.ytp-ad-module',
                    '[class*="ad"]',
                    '[id*="ad"]'
                ];
                
                adSelectors.forEach(selector => {
                    const elements = iframeDoc.querySelectorAll(selector);
                    elements.forEach(el => {
                        if (el && el.parentNode) {
                            el.parentNode.removeChild(el);
                        }
                    });
                });
            } catch (e) {
                // Cross-origin restrictions
            }
        }

        function injectAdBlockingScripts() {
            // Inject scripts that block common ad patterns
            const script = document.createElement('script');
            script.textContent = `
                // Block YouTube ad requests
                const originalFetch = window.fetch;
                window.fetch = function(...args) {
                    if (args[0] && args[0].includes('ads.youtube.com')) {
                        return Promise.reject(new Error('Ad blocked'));
                    }
                    return originalFetch.apply(this, args);
                };
                
                // Block XMLHttpRequest ads
                const originalXHR = window.XMLHttpRequest.prototype.open;
                window.XMLHttpRequest.prototype.open = function(method, url) {
                    if (url && url.includes('ads.youtube.com')) {
                        return;
                    }
                    return originalXHR.apply(this, arguments);
                };
                
                console.log('Ad blocking scripts injected');
            `;
            document.head.appendChild(script);
        }

        function forceSkipAds() {
            // Aggressive ad skipping
            document.getElementById('adSkipIndicator').style.display = 'block';
            
            // Try multiple methods to skip ads
            setTimeout(() => {
                if (player && player.seekTo) {
                    // Method 1: Seek to end of potential ad
                    player.seekTo(player.getDuration() - 1, true);
                }
            }, 100);
            
            setTimeout(() => {
                // Method 2: Force next video if ad persists
                if (player && player.getPlayerState() !== YT.PlayerState.PLAYING) {
                    playNextVideo();
                }
                document.getElementById('adSkipIndicator').style.display = 'none';
            }, 2000);
        }

        // Control functions
        document.getElementById('playPauseBtn').addEventListener('click', function () {
            if (player && player.getPlayerState) {
                if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                    player.pauseVideo();
                } else {
                    player.playVideo();
                    forceSkipAds(); // Skip any ads when playing
                }
            }
        });

        document.getElementById('prevBtn').addEventListener('click', playPrevVideo);
        document.getElementById('nextBtn').addEventListener('click', playNextVideo);

        document.getElementById('skipBackwardBtn').addEventListener('click', function () {
            if (player && player.getCurrentTime) {
                const currentTime = player.getCurrentTime();
                player.seekTo(Math.max(0, currentTime - 10), true);
            }
        });

        document.getElementById('skipForwardBtn').addEventListener('click', function () {
            if (player && player.getCurrentTime) {
                const currentTime = player.getCurrentTime();
                player.seekTo(currentTime + 10, true);
            }
        });

        function playPrevVideo() {
            if (searchResults.length > 0) {
                let prevIndex = (currentVideoIndex - 1 + searchResults.length) % searchResults.length;
                let attempts = 0;

                while (attempts < searchResults.length && blockedVideos.includes(searchResults[prevIndex].id)) {
                    prevIndex = (prevIndex - 1 + searchResults.length) % searchResults.length;
                    attempts++;
                }

                if (attempts < searchResults.length) {
                    currentVideoIndex = prevIndex;
                    player.loadVideoById(searchResults[currentVideoIndex].id);
                    updatePlaylistUI();
                    updateNowPlaying();
                    forceSkipAds();
                }
            }
        }

        function playNextVideo() {
            if (searchResults.length > 0) {
                let nextIndex = (currentVideoIndex + 1) % searchResults.length;
                let attempts = 0;

                while (attempts < searchResults.length && blockedVideos.includes(searchResults[nextIndex].id)) {
                    nextIndex = (nextIndex + 1) % searchResults.length;
                    attempts++;
                }

                if (attempts < searchResults.length) {
                    currentVideoIndex = nextIndex;
                    player.loadVideoById(searchResults[currentVideoIndex].id);
                    updatePlaylistUI();
                    updateNowPlaying();
                    forceSkipAds();
                }
            }
        }

        // Progress tracking
        function startProgressTracking() {
            stopProgressTracking();
            progressInterval = setInterval(updateProgress, 1000);
        }

        function stopProgressTracking() {
            if (progressInterval) clearInterval(progressInterval);
        }

        function updateProgress() {
            if (player && player.getCurrentTime && player.getDuration) {
                const currentTime = player.getCurrentTime();
                const duration = player.getDuration();

                document.getElementById('currentTime').textContent = formatTime(currentTime);
                document.getElementById('duration').textContent = formatTime(duration);

                const progress = (currentTime / duration) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function seekToPosition(e) {
            if (player && player.getDuration) {
                const progressContainer = document.getElementById('progressContainer');
                const clickPosition = e.offsetX / progressContainer.offsetWidth;
                const duration = player.getDuration();
                const seekTime = duration * clickPosition;
                player.seekTo(seekTime, true);
            }
        }

        // Search functionality
        document.getElementById('searchBtn').addEventListener('click', performSearch);
        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') performSearch();
        });

        // Clear playlist
        document.getElementById('clearPlaylist').addEventListener('click', function () {
            searchResults = [];
            blockedVideos = [];
            currentVideoIndex = 0;
            document.getElementById('playlistItems').innerHTML = '<div class="loading">Search for music to populate the playlist</div>';
            document.getElementById('nowPlaying').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            if (player && player.stopVideo) player.stopVideo();
            stopProgressTracking();
            document.getElementById('currentTime').textContent = '0:00';
            document.getElementById('duration').textContent = '0:00';
            document.getElementById('progressBar').style.width = '0%';
        });

        // Enhanced search focusing on ad-free content
        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            document.getElementById('playlistItems').innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Searching for ad-free content...</div>';
            document.getElementById('errorMessage').style.display = 'none';

            try {
                // Use multiple ad-free search terms
                const randomTerm = adFreeSearchTerms[Math.floor(Math.random() * adFreeSearchTerms.length)];
                const searchQuery = `${query} ${randomTerm}`;

                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&q=${encodeURIComponent(searchQuery)}&type=video&key=${API_KEY}`);
                const data = await response.json();

                if (data.error) throw new Error(data.error.message);
                if (data.items.length === 0) {
                    document.getElementById('playlistItems').innerHTML = '<div class="error">No results found. Try a different search.</div>';
                    return;
                }

                const videoIds = data.items.map(item => item.id.videoId).join(',');
                const detailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails,snippet,statistics&id=${videoIds}&key=${API_KEY}`);
                const detailsData = await detailsResponse.json();

                searchResults = data.items.map(item => {
                    const videoDetails = detailsData.items.find(detail => detail.id === item.id.videoId);
                    return {
                        id: item.id.videoId,
                        title: item.snippet.title,
                        thumbnail: item.snippet.thumbnails.medium.url,
                        channel: item.snippet.channelTitle,
                        duration: formatDuration(videoDetails ? videoDetails.contentDetails.duration : 'PT0M0S'),
                        viewCount: videoDetails ? parseInt(videoDetails.statistics.viewCount) : 0
                    };
                });

                // Prioritize content from ad-free channels and lower view counts
                searchResults.sort((a, b) => {
                    const aIsAdFree = isAdFreeContent(a);
                    const bIsAdFree = isAdFreeContent(b);
                    
                    if (aIsAdFree && !bIsAdFree) return -1;
                    if (!aIsAdFree && bIsAdFree) return 1;
                    return a.viewCount - b.viewCount;
                });

                blockedVideos = [];
                renderPlaylist();

                if (searchResults.length > 0) {
                    currentVideoIndex = 0;
                    if (player && player.loadVideoById) {
                        player.loadVideoById(searchResults[0].id);
                        updatePlaylistUI();
                        updateNowPlaying();
                        forceSkipAds();
                    }
                }
            } catch (error) {
                console.error('Error searching YouTube:', error);
                document.getElementById('playlistItems').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function isAdFreeContent(video) {
            const title = video.title.toLowerCase();
            const channel = video.channel.toLowerCase();
            
            // Check for ad-free indicators
            const adFreeIndicators = [
                'no copyright',
                'royalty free',
                'creative commons',
                'non copyrighted',
                'copyright free',
                'non monetized'
            ];
            
            const hasAdFreeIndicator = adFreeIndicators.some(indicator => 
                title.includes(indicator.toLowerCase())
            );
            
            const isAdFreeChannel = adFreeChannels.some(adFreeChannel => 
                channel.includes(adFreeChannel.toLowerCase())
            );
            
            return hasAdFreeIndicator || isAdFreeChannel || video.viewCount < 50000;
        }

        function formatDuration(duration) {
            const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            if (!match) return 'Unknown';

            const hours = (match[1] || '').replace('H', '');
            const minutes = (match[2] || '').replace('M', '');
            const seconds = (match[3] || '').replace('S', '');

            if (hours) {
                return `${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}`;
            } else if (minutes) {
                return `${minutes}:${seconds.padStart(2, '0')}`;
            } else {
                return `0:${seconds.padStart(2, '0')}`;
            }
        }

        function renderPlaylist() {
            const playlistContainer = document.getElementById('playlistItems');
            playlistContainer.innerHTML = '';

            if (searchResults.length === 0) {
                playlistContainer.innerHTML = '<div class="loading">No results found. Try a different search.</div>';
                return;
            }

            searchResults.forEach((video, index) => {
                const isBlocked = blockedVideos.includes(video.id);
                const item = document.createElement('div');
                item.className = `playlist-item ${isBlocked ? 'blocked' : ''}`;
                if (index === currentVideoIndex && !isBlocked) {
                    item.classList.add('active');
                }

                item.innerHTML = `
                    <img src="${video.thumbnail}" alt="${video.title}" class="thumbnail">
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${video.title}</div>
                        <div style="font-size: 0.8rem; color: #a0a0c0;">${video.channel}</div>
                    </div>
                    <span class="duration">${video.duration}</span>
                `;

                if (!isBlocked) {
                    item.addEventListener('click', function () {
                        currentVideoIndex = index;
                        if (player && player.loadVideoById) {
                            player.loadVideoById(video.id);
                            updatePlaylistUI();
                            updateNowPlaying();
                            forceSkipAds();
                        }
                    });
                }

                playlistContainer.appendChild(item);
            });
        }

        function updatePlaylistUI() {
            const items = document.querySelectorAll('.playlist-item');
            items.forEach((item, index) => {
                const isBlocked = blockedVideos.includes(searchResults[index].id);
                if (index === currentVideoIndex && !isBlocked) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function updateNowPlaying() {
            if (searchResults.length > 0 && currentVideoIndex >= 0) {
                const currentVideo = searchResults[currentVideoIndex];
                document.getElementById('nowPlayingThumb').src = currentVideo.thumbnail;
                document.getElementById('nowPlayingTitle').textContent = currentVideo.title;
                document.getElementById('nowPlayingChannel').textContent = currentVideo.channel;
                document.getElementById('nowPlaying').style.display = 'flex';
            }
        }

        // Load YouTube API
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // Initialize with ad-free content
        window.addEventListener('load', function () {
            document.getElementById('searchInput').value = 'lofi study music no copyright';
            performSearch();
        });

        // Additional ad-blocking: Block YouTube's ad domains
        window.addEventListener('load', function() {
            // This is a client-side attempt to block ad domains
            const blockedDomains = [
                '/pagead/',
                '/googleads/',
                '/doubleclick/',
                '/adsystem/',
                '/adservice/'
            ];
            
            // Override fetch to block ad requests
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const url = args[0];
                if (typeof url === 'string' && blockedDomains.some(domain => url.includes(domain))) {
                    console.log('Blocked ad request:', url);
                    return Promise.reject(new Error('Ad request blocked'));
                }
                return originalFetch.apply(this, args);
            };
        });
    </script>
</body>
</html>
