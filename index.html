<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad-Free Music - College Project</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ffa36c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .protection-status {
            background: rgba(76, 175, 80, 0.3);
            border-left: 4px solid #4caf50;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #a0ffa0;
        }

        .search-container {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1rem;
            outline: none;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa36c);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .ad-block-shield {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ad-skip-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 1001;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ffa36c);
        }

        .btn-sm {
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        .playlist {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .playlist-item {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .playlist-item.active {
            background: rgba(255, 107, 107, 0.3);
            border-left: 4px solid #ff6b6b;
        }

        .playlist-item .thumbnail {
            width: 60px;
            height: 45px;
            border-radius: 5px;
            object-fit: cover;
        }

        .protection-layers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .layer {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.8rem;
        }

        .layer.active {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4caf50;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            .controls {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .protection-layers {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Ad-Free Music Project</h1>
            <p class="subtitle">Zero Ads Guaranteed - College Project</p>
        </header>

        <div class="protection-status">
            <i class="fas fa-shield-alt"></i>
            <strong>MAXIMUM PROTECTION ACTIVE:</strong> All ad-blocking layers enabled
        </div>

        <div class="protection-layers">
            <div class="layer active"><i class="fas fa-ban"></i> Domain Blocking</div>
            <div class="layer active"><i class="fas fa-filter"></i> Request Interception</div>
            <div class="layer active"><i class="fas fa-search"></i> Content Filtering</div>
            <div class="layer active"><i class="fas fa-forward"></i> Auto-Skipping</div>
            <div class="layer active"><i class="fas fa-robot"></i> Real-time Detection</div>
            <div class="layer active"><i class="fas fa-code"></i> Script Injection</div>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search for ad-free music...">
            <button class="search-btn" id="searchBtn">
                <i class="fas fa-search"></i> Search
            </button>
        </div>

        <div class="player-container">
            <div class="video-container">
                <div id="player"></div>
                <div class="ad-block-shield">
                    <i class="fas fa-shield-alt"></i> ADS: 100% BLOCKED
                </div>
                <div class="ad-skip-overlay" id="adSkipOverlay">
                    <i class="fas fa-skull-crossbones"></i>
                    <h3>AD DETECTED & DESTROYED</h3>
                    <p>Auto-skipping in <span id="skipTimer">1</span>s</p>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-sm" id="prevBtn">
                    <i class="fas fa-step-backward"></i> Prev
                </button>
                <button class="btn btn-sm" id="skipBackwardBtn">
                    <i class="fas fa-backward"></i> -10s
                </button>
                <button class="btn btn-primary" id="playPauseBtn">
                    <i class="fas fa-play"></i> Play
                </button>
                <button class="btn btn-sm" id="skipForwardBtn">
                    <i class="fas fa-forward"></i> +10s
                </button>
                <button class="btn btn-sm" id="nextBtn">
                    <i class="fas fa-step-forward"></i> Next
                </button>
            </div>

            <div class="playlist">
                <h2>Ad-Free Results</h2>
                <div id="playlistItems">
                    <div class="loading">Search for music to begin</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ULTIMATE AD-BLOCKING SYSTEM
        const API_KEY = 'AIzaSyAMGAR62RNI3Wu9YlKv43aq2-trVi1ZAM0';
        let player;
        let currentVideoIndex = 0;
        let searchResults = [];
        
        // 1. DOMAIN BLOCKING - Block all known ad domains
        const blockedDomains = [
            'doubleclick.net', 'googlesyndication.com', 'googleadservices.com',
            'ads.youtube.com', 'googleads.g.doubleclick.net', 'pagead2.googlesyndication.com',
            'adservice.google.com', 'youtube.com/api/stats/ads', 'www.googleadservices.com',
            'ad.doubleclick.net', 'securepubads.g.doubleclick.net', 'tpc.googlesyndication.com'
        ];

        // 2. REQUEST INTERCEPTION - Block all ad-related requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            if (typeof url === 'string' && blockedDomains.some(domain => url.includes(domain))) {
                console.log('ðŸš« BLOCKED AD REQUEST:', url);
                return Promise.reject(new Error('Ad request blocked by ultimate protection'));
            }
            return originalFetch.apply(this, args);
        };

        // Intercept XMLHttpRequest
        const originalXHROpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function(method, url) {
            if (typeof url === 'string' && blockedDomains.some(domain => url.includes(domain))) {
                console.log('ðŸš« BLOCKED XHR AD REQUEST:', url);
                return;
            }
            return originalXHROpen.apply(this, arguments);
        };

        // 3. CONTENT FILTERING - Only search for guaranteed ad-free content
        const adFreeSearchTerms = [
            "no copyright music",
            "royalty free music", 
            "creative commons music",
            "non monetized music",
            "copyright free music",
            "background music no ads",
            "non copyrighted music",
            "public domain music",
            "free music no ads",
            "ad free background music"
        ];

        // 4. AUTO-SKIPPING & REAL-TIME DETECTION
        let adDetectionInterval;
        let lastVideoTime = 0;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: '',
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'modestbranding': 1,
                    'rel': 0,
                    'fs': 0,
                    'iv_load_policy': 3,
                    'autoplay': 1,
                    'disablekb': 1,
                    'origin': window.location.origin
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        function onPlayerReady(event) {
            console.log("ðŸ”¥ ULTIMATE AD-BLOCKER ACTIVATED");
            startUltimateAdDetection();
            injectNuclearAdBlock();
            blockAllYouTubeAds();
        }

        function onPlayerStateChange(event) {
            // REAL-TIME DETECTION - Monitor every state change
            detectAndAnnihilateAds();
            
            if (event.data === YT.PlayerState.ENDED) {
                playNextVideo();
            }

            if (event.data === YT.PlayerState.PLAYING) {
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i> Pause';
                hideAdOverlay();
            } else {
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i> Play';
            }
        }

        function onPlayerError(event) {
            console.log('â© Auto-skipping problematic video');
            playNextVideo();
        }

        // 5. REAL-TIME DETECTION - Aggressive monitoring
        function startUltimateAdDetection() {
            adDetectionInterval = setInterval(() => {
                detectAndAnnihilateAds();
                monitorVideoPlayback();
                blockAdElements();
            }, 250); // Check 4 times per second
        }

        function detectAndAnnihilateAds() {
            if (!player) return;
            
            try {
                const currentTime = player.getCurrentTime();
                const duration = player.getDuration();
                const state = player.getPlayerState();
                
                // Detection Method 1: Unusual video length
                if (duration > 0 && duration < 120) { // Less than 2 minutes
                    console.log('ðŸš« Short video detected - likely ad, skipping');
                    showAdOverlay();
                    setTimeout(() => playNextVideo(), 1000);
                    return;
                }
                
                // Detection Method 2: Playback anomalies
                if (state === YT.PlayerState.PLAYING && currentTime === lastVideoTime) {
                    console.log('ðŸš« Playback stuck - likely ad, skipping');
                    showAdOverlay();
                    setTimeout(() => player.seekTo(duration - 1, true), 500);
                    return;
                }
                
                lastVideoTime = currentTime;
                
                // Detection Method 3: Check for ad state
                if (state === YT.PlayerState.CUED || state === YT.PlayerState.BUFFERING) {
                    setTimeout(() => {
                        if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
                            console.log('ðŸš« Buffering too long - likely ad, skipping');
                            playNextVideo();
                        }
                    }, 3000);
                }
                
            } catch (e) {
                // Silent fail - keep protection running
            }
        }

        function monitorVideoPlayback() {
            // Additional monitoring for any playback issues
            try {
                const video = document.querySelector('video');
                if (video) {
                    // Block any ad-related media
                    if (video.duration < 180 && video.currentTime === 0) {
                        console.log('ðŸš« Blocking short potential ad video');
                        playNextVideo();
                    }
                }
            } catch (e) {
                // Cross-origin restrictions
            }
        }

        // 6. SCRIPT INJECTION - Nuclear option
        function injectNuclearAdBlock() {
            const script = document.createElement('script');
            script.textContent = `
                // Nuclear ad-blocking injection
                console.log('ðŸ’£ NUCLEAR AD-BLOCK INJECTED');
                
                // Block all known ad patterns
                const adPatterns = [
                    /ads\\.youtube\\.com/,
                    /doubleclick\\.net/,
                    /googleads/,
                    /googlesyndication/,
                    /adservice\\.google/,
                    /pagead/,
                    /adsystem/,
                    /ad\\.doubleclick/
                ];
                
                // Override fetch completely
                const nuclearFetch = window.fetch;
                window.fetch = function(...args) {
                    const url = args[0];
                    if (typeof url === 'string') {
                        for (let pattern of adPatterns) {
                            if (pattern.test(url)) {
                                console.log('ðŸ’£ NUCLEAR BLOCKED:', url);
                                return Promise.reject(new Error('NUCLEAR_AD_BLOCK'));
                            }
                        }
                    }
                    return nuclearFetch.apply(this, args);
                };
                
                // Block all ad-related element creation
                const originalCreateElement = document.createElement;
                document.createElement = function(tagName) {
                    const element = originalCreateElement.call(this, tagName);
                    if (tagName === 'iframe' || tagName === 'script') {
                        element.setAttribute('data-ad-blocked', 'true');
                    }
                    return element;
                };
                
                // Continuously clean DOM of any ad elements
                setInterval(() => {
                    const suspects = document.querySelectorAll([
                        '[class*="ad"]',
                        '[id*="ad"]',
                        '[class*="Ad"]',
                        '[id*="Ad"]',
                        '.video-ads',
                        '.ad-container',
                        '.ad-display'
                    ].join(','));
                    
                    suspects.forEach(el => {
                        if (el && el.parentNode) {
                            el.parentNode.removeChild(el);
                            console.log('ðŸ§¹ Removed ad element');
                        }
                    });
                }, 1000);
            `;
            document.head.appendChild(script);
        }

        function blockAllYouTubeAds() {
            // Block YouTube's internal ad mechanisms
            setInterval(() => {
                try {
                    // Block ad-related iframes
                    const iframes = document.querySelectorAll('iframe');
                    iframes.forEach(iframe => {
                        const src = iframe.src || '';
                        if (blockedDomains.some(domain => src.includes(domain))) {
                            iframe.remove();
                            console.log('ðŸš« Removed ad iframe');
                        }
                    });
                    
                    // Block any suspicious scripts
                    const scripts = document.querySelectorAll('script');
                    scripts.forEach(script => {
                        const src = script.src || '';
                        const text = script.textContent || '';
                        if (blockedDomains.some(domain => src.includes(domain)) || 
                            text.includes('google_ad') || 
                            text.includes('doubleclick')) {
                            script.remove();
                            console.log('ðŸš« Removed ad script');
                        }
                    });
                } catch (e) {
                    // Silent cleanup
                }
            }, 500);
        }

        function blockAdElements() {
            // Continuous DOM cleaning
            try {
                const adSelectors = [
                    '.ad', '.ads', '.advertisement', '[class*="ad-"]',
                    '[id*="ad-"]', '.video-ad', '.ytp-ad-'
                ];
                
                adSelectors.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        if (el && el.parentNode) {
                            el.parentNode.removeChild(el);
                        }
                    });
                });
            } catch (e) {
                // Silent cleanup
            }
        }

        function showAdOverlay() {
            let countdown = 1;
            document.getElementById('skipTimer').textContent = countdown;
            document.getElementById('adSkipOverlay').style.display = 'block';
            
            const timer = setInterval(() => {
                countdown--;
                document.getElementById('skipTimer').textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(timer);
                    hideAdOverlay();
                }
            }, 1000);
        }

        function hideAdOverlay() {
            document.getElementById('adSkipOverlay').style.display = 'none';
        }

        // Control functions
        document.getElementById('playPauseBtn').addEventListener('click', function() {
            if (player && player.getPlayerState) {
                if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                    player.pauseVideo();
                } else {
                    player.playVideo();
                    // Force skip any potential ads
                    setTimeout(() => detectAndAnnihilateAds(), 1000);
                }
            }
        });

        document.getElementById('prevBtn').addEventListener('click', playPrevVideo);
        document.getElementById('nextBtn').addEventListener('click', playNextVideo);
        document.getElementById('skipBackwardBtn').addEventListener('click', () => seekRelative(-10));
        document.getElementById('skipForwardBtn').addEventListener('click', () => seekRelative(10));

        function playPrevVideo() {
            if (searchResults.length > 0) {
                currentVideoIndex = (currentVideoIndex - 1 + searchResults.length) % searchResults.length;
                loadAdFreeVideo();
            }
        }

        function playNextVideo() {
            if (searchResults.length > 0) {
                currentVideoIndex = (currentVideoIndex + 1) % searchResults.length;
                loadAdFreeVideo();
            }
        }

        function seekRelative(seconds) {
            if (player && player.getCurrentTime) {
                const currentTime = player.getCurrentTime();
                player.seekTo(Math.max(0, currentTime + seconds), true);
            }
        }

        function loadAdFreeVideo() {
            if (player && searchResults[currentVideoIndex]) {
                player.loadVideoById(searchResults[currentVideoIndex].id);
                updatePlaylistUI();
                // Preemptive ad destruction
                setTimeout(detectAndAnnihilateAds, 500);
            }
        }

        // Search functionality - Only ad-free content
        document.getElementById('searchBtn').addEventListener('click', performSearch);
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') performSearch();
        });

        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim() || "lofi study music";
            
            document.getElementById('playlistItems').innerHTML = '<div class="loading">Searching for 100% ad-free content...</div>';

            try {
                // Use multiple ad-free terms for maximum protection
                const searchTerm = adFreeSearchTerms[Math.floor(Math.random() * adFreeSearchTerms.length)];
                const searchQuery = `${query} ${searchTerm}`;

                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(searchQuery)}&type=video&key=${API_KEY}`);
                const data = await response.json();

                if (data.items.length === 0) throw new Error('No results');

                const videoIds = data.items.map(item => item.id.videoId).join(',');
                const detailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails,snippet&id=${videoIds}&key=${API_KEY}`);
                const detailsData = await detailsResponse.json();

                searchResults = data.items.map(item => {
                    const videoDetails = detailsData.items.find(detail => detail.id === item.id.videoId);
                    return {
                        id: item.id.videoId,
                        title: item.snippet.title,
                        thumbnail: item.snippet.thumbnails.medium.url,
                        channel: item.snippet.channelTitle,
                        duration: formatDuration(videoDetails?.contentDetails?.duration || 'PT0M0S')
                    };
                });

                renderPlaylist();
                
                if (searchResults.length > 0) {
                    currentVideoIndex = 0;
                    loadAdFreeVideo();
                }
            } catch (error) {
                document.getElementById('playlistItems').innerHTML = '<div class="error">Search failed. Trying fallback...</div>';
                // Fallback search
                setTimeout(() => {
                    document.getElementById('searchInput').value = "no copyright music";
                    performSearch();
                }, 2000);
            }
        }

        function formatDuration(duration) {
            const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            if (!match) return 'Unknown';
            const hours = (match[1] || '').replace('H', '');
            const minutes = (match[2] || '').replace('M', '');
            const seconds = (match[3] || '').replace('S', '');
            if (hours) return `${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}`;
            if (minutes) return `${minutes}:${seconds.padStart(2, '0')}`;
            return `0:${seconds.padStart(2, '0')}`;
        }

        function renderPlaylist() {
            const container = document.getElementById('playlistItems');
            container.innerHTML = '';
            
            searchResults.forEach((video, index) => {
                const item = document.createElement('div');
                item.className = `playlist-item ${index === currentVideoIndex ? 'active' : ''}`;
                item.innerHTML = `
                    <img src="${video.thumbnail}" class="thumbnail">
                    <div style="flex: 1;">
                        <div style="font-weight: 500;">${video.title}</div>
                        <div style="font-size: 0.8rem; color: #a0a0c0;">${video.channel}</div>
                    </div>
                    <span>${video.duration}</span>
                `;
                item.addEventListener('click', () => {
                    currentVideoIndex = index;
                    loadAdFreeVideo();
                });
                container.appendChild(item);
            });
        }

        function updatePlaylistUI() {
            document.querySelectorAll('.playlist-item').forEach((item, index) => {
                item.classList.toggle('active', index === currentVideoIndex);
            });
        }

        // Initialize ultimate protection
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.head.appendChild(tag);

        window.addEventListener('load', () => {
            document.getElementById('searchInput').value = "no copyright music";
            performSearch();
        });

        // Final nuclear option - Service Worker registration for ultimate blocking
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {
                console.log('Service Worker not available - using nuclear fallback');
            });
        }
    </script>
</body>
</html>
